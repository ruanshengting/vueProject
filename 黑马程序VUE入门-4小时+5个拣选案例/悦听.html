<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <!-- æ ·å¼ -->
    <link rel="stylesheet" href="yy.css" />
  </head>

  <body>
    <div class="wrap">
      <div class="play_wrap" id="player">
        <div class="search_bar">
          <img src="img/ä¸‹è½½ (4).png" alt="" />
          <!-- æœç´¢æ­Œæ›² -->
          <input
            type="text"
            autocomplete="off"
            v-model="query"
            @keyup.enter="searchMusic();"
          />
        </div>
        <div class="center_con">
          <!-- æœç´¢æ­Œæ›²åˆ—è¡¨ -->
          <div class="song_wrapper" ref="song_wrapper">
            <ul class="song_list">
              <li v-for="item in musicList">
                <!-- ç‚¹å‡»æ”¾æ­Œ -->
                <a href="javascript:;" @click="playMusic(item.id)"></a>
                <b>{{item.name}}</b>
                <span>
                  <i @click="playMv(item.mvid)" v-if="item.mvid!=0"></i>
                </span>
              </li>
            </ul>
            <img src="img/ä¸‹è½½ (11).png" class="switch_btn" alt="" />
          </div>
          <!-- æ­Œæ›²ä¿¡æ¯å®¹å™¨ -->
          <div class="player_con" :class="{playing:isPlay}">
            <img src="img/ä¸‹è½½ (5).png" class="play_bar" />
            <!-- é»‘èƒ¶ç¢Ÿç‰‡ -->
            <img src="img/ä¸‹è½½ (12).png" class="disc autoRotate" />
            <!-- <img :src="coverUrl==''?'./img/ä¸‹è½½ (13).png" class="cover autoRotate" /> -->
          </div>
          <!-- è¯„è®ºå®¹å™¨ -->
          <div class="comment_wrapper" ref="comment_wrapper">
            <h5 class="title">çƒ­é—¨ç•™è¨€</h5>
            <div class="comment_list">
              <dl v-for="item in hotComments">
                <dt>
                  <img :src="item.user.avatarUrl" alt="" />
                </dt>
                <dd class="name">{{item.user.nickname}}</dd>
                <dd class="detail">
                  {{item.content}}
                </dd>
              </dl>
            </div>
            <img src="img/ä¸‹è½½ (11).png" class="right_line" />
          </div>
        </div>
        <div class="audio_con">
          <audio
            ref="audio"
            @play="play"
            @pause="pause"
            :src="musicUrl"
            controls
            autoplay
            loop
            class="myaudio"
          ></audio>
        </div>
        <div class="video_con" v-show="showVideo">
          <video ref="video" :src="mvUrl" controls="controls"></video>
          <div class="mask" @click="closeMv"></div>
        </div>
      </div>
    </div>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <!-- å¼€å‘ç¯å¢ƒç‰ˆæœ¬ï¼ŒåŒ…å«äº†æœ‰å¸®åŠ©çš„å‘½ä»¤è¡Œè­¦å‘Š -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script> -->
    <!-- å®˜ç½‘æä¾›çš„ axios åœ¨çº¿åœ°å€ -->
    <!-- <script src="https://unpkg.com/axios/dist/axios.min.js"></script> -->
    <script>
      // è®¾ç½®axiosçš„åŸºåœ°å€
      axios.defaults.baseURL = 'https://autumnfish.cn'
      // axios.defaults.baseURL = 'http://localhost:3000';

      // å®ä¾‹åŒ–vue
      var app = new Vue({
        el: '#player',
        data: {
          // æœç´¢å…³é”®å­—
          query: '',
          // æ­Œæ›²åˆ—è¡¨
          musicList: [],
          // æ­Œæ›²url
          musicUrl: '',
          // æ˜¯å¦æ­£åœ¨æ’­æ”¾
          isPlay: false,
          // æ­Œæ›²çƒ­é—¨è¯„è®º
          hotComments: [],
          // æ­Œæ›²å°é¢åœ°å€
          coverUrl: '',
          // æ˜¾ç¤ºè§†é¢‘æ’­æ”¾
          showVideo: false,
          // mvåœ°å€
          mvUrl: '',
        },
        // æ–¹æ³•
        methods: {
          // æœç´¢æ­Œæ›²
          searchMusic() {
            if (this.query == 0) {
              return
            }
            axios.get('/search?keywords=' + this.query).then((response) => {
              console.log(
                'ğŸš€ ~ file: æ‚¦å¬.html ~ line 122 ~ axios.get ~ response',
                response,
              )
              // ä¿å­˜å†…å®¹
              this.musicList = response.data.result.songs
            })

            // æ¸…ç©ºæœç´¢
            this.query = ''
          },
          // æ’­æ”¾æ­Œæ›²
          playMusic(musicId) {
            // è·å–æ­Œæ›²url
            axios.get('/song/url?id=' + musicId).then((response) => {
              console.log(
                'ğŸš€ ~ file: æ‚¦å¬.html ~ line 137 ~ axios.get ~ response',
                response,
              )
              // ä¿å­˜æ­Œæ›²urlåœ°å€
              this.musicUrl = response.data.data[0].url
            })
            // è·å–æ­Œæ›²çƒ­é—¨è¯„è®º
            axios.get('/comment/hot?type=0&id=' + musicId).then((response) => {
              // console.log(response)
              // ä¿å­˜çƒ­é—¨è¯„è®º
              this.hotComments = response.data.hotComments
            })
            // è·å–æ­Œæ›²å°é¢
            axios.get('/song/detail?ids=' + musicId).then((response) => {
              // console.log(response)
              // è®¾ç½®å°é¢
              this.coverUrl = response.data.songs[0].al.picUrl
            })
          },
          // audioçš„playäº‹ä»¶
          play() {
            this.isPlay = true
            // æ¸…ç©ºmvçš„ä¿¡æ¯
            this.mvUrl = ''
          },
          // audioçš„pauseäº‹ä»¶
          pause() {
            this.isPlay = false
          },
          // æ’­æ”¾mv
          playMv(vid) {
            if (vid) {
              this.showVideo = true
              // è·å–mvä¿¡æ¯
              axios.get('/mv/url?id=' + vid).then((response) => {
                console.log(response)
                // æš‚åœæ­Œæ›²æ’­æ”¾
                this.$refs.audio.pause()
                // è·å–mvåœ°å€
                this.mvUrl = response.data.data.url
                console.log(
                  'ğŸš€ ~ file: æ‚¦å¬.html ~ line 168 ~ axios.get ~ this.mvUrl',
                  this.mvUrl,
                )
              })
            }
          },
          // å…³é—­mvç•Œé¢
          closeMv() {
            this.showVideo = false
            this.$refs.video.pause()
          },
          // æœç´¢å†å²è®°å½•ä¸­çš„æ­Œæ›²
          historySearch(history) {
            this.query = history
            this.searchMusic()
            this.showHistory = false
          },
        },
      })
    </script>
  </body>
</html>
